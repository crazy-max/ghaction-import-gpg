name: ci

on:
  push:
    branches:
      - 'master'
    paths-ignore:
      - '**.md'
  pull_request:
    paths-ignore:
      - '**.md'

jobs:
  ci:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os:
          - ubuntu-latest
          - macOS-latest
          - windows-latest
    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      -
        name: Read test env variable
        uses: pCYSl5EDgo/cat@master
        id: test-key
        with:
          path: ./.github/test-key.pgp

      -
        name: Import GPG private key
        id: import_gpg
        uses: ./
        with:
          git_user_signingkey: true
          git_commit_gpgsign: true
          git_tag_gpgsign: true
          git_push_gpgsign: true
          git_committer_name: Joe Tester
          git_committer_email: joe@foo.bar
        env:
          GPG_PRIVATE_KEY: ${{ steps.test-key.outputs.text }}
          PASSPHRASE: 'with stupid passphrase'
      -
        name: GPG user IDs
        run: |
          echo "fingerprint: ${{ steps.import_gpg.outputs.fingerprint }}"
          echo "keyid:       ${{ steps.import_gpg.outputs.keyid }}"
          echo "email:       ${{ steps.import_gpg.outputs.email }}"
